# Custom configuration for the Fluid Earth web application data files
<IfModule mime_module>
    AddEncoding br .br
    AddType application/octet-stream .fp16
</IfModule>

# All the following rewrites are for backwards compatibility only
<IfModule rewrite_module>
    RewriteEngine On

    # Serve the pre-compressed files (typically will be .fp16.br) when older
    # versions of Fluid Earth ask for the uncompressed path.
    #
    # For example, rewrites a request like /data/some-dataset/some-date.fp16 to
    # /data/some-dataset/some-date.fp16.br
    RewriteCond %{REQUEST_FILENAME}.br -f
    RewriteRule (.*) $1.br [L]

    # While we convert existing .fp16 files to .fp16.br, respond to requests for .br
    # files with their uncompressed (technically, gzipped on the fly) versions if
    # the .br file is not found.
    #
    # For example, rewrites a request like /data/some-dataset/some-date.fp16.br to
    # /data/some-dataset/some-date.fp16 (only if the former does not exist)
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} \.fp16\.br$
    RewriteRule (.*)\.br $1 [L]
</IfModule>
